import{u as ye,r as o,c as te,o as Ie,w as ge,a as _,b as f,d as n,e as F,f as j,g as V,h as Y,i as H,p as W,j as y,S as Be,k as h,l as a,m as r,n as De,q as R,t as ke,s as be,v as Te,x as Ke}from"./index-ccb2eb73.js";import{u as Se,_ as oe}from"./useManagementUtils-420e0095.js";const Pe={__name:"Book",setup(Ae){const I=ye(),z=I.currentRoute.value.params.type,v=z=="details",J=o(!1),ue=o(!1),d=o("N"),q=["mdi-bookshelf","mdi-book-open-page-variant-outline","mdi-calendar-check-outline"];console.log("readstatus: "+d.value);const Q=te(()=>d.value==="N"?0:d.value==="P"?1:2),G=te(()=>q[Q.value]),P=o("");o(null),o(null);const ee=o(null),le=o(null),O=o(!1),N=o(null);o(!1);const g=o(!1),w=o(null),U=o("green");o(null);const x=o("2023"),B=o(2.5),C=o(""),ne=o(null),X=o(""),s=o(null),c=o(null),D=o(null),k=o({OS_ID:null,OS_NAME:null}),b=o({PS_ID:null,PS_PUBLISHERNAME:null}),T=o(""),K=o(""),S=o(""),A=o("");o("");const{titlevalue:re,keyvalue:Ee,keyID:Oe,newtitle:ve,modifytitle:Ne,deletetitle:xe,setMetaByCat:M,setItem:ie}=Se();function L(u,e,t){const p=o(-1);for(let i=0;i<u.value.length&&p.value==-1;i++)u.value[i][e]==t&&(p.value=i);return p.value}const de=async u=>{console.log("route: ",I.currentRoute.value.params.type);try{console.log("currroute: ",I.currentRoute.value.query.id);const e=await F.get("/api/data/"+u+"/NULL");console.log("response: ",e.data),P.value=e.data[0].BK_BOOKTITLE,d.value=e.data[0].BK_READED,s.value=j.value[L(j,"AT_ID",e.data[0].BK_AT)].AT_AUTHORNAME,console.log("actauthor: ",s.value),c.value=V.value[L(V,"CG_ID",e.data[0].BK_CG_ID)].CG_CATEGORY,D.value=Y.value[L(Y,"BT_ID",e.data[0].BK_BT)].BT_TYPENAME,e.data[0].BK_OS_ID!=null&&(k.value.OS_ID=e.data[0].BK_OS_ID,k.value.OS_NAME=H.value[L(H,"OS_ID",e.data[0].BK_OS_ID)].OS_NAME),e.data[0].BK_PS_ID!=null&&(b.value.PS_ID=e.data[0].BK_PS_ID,b.value.PS_PUBLISHERNAME=W.value[L(W,"PS_ID",e.data[0].BK_PS_ID)].PS_PUBLISHERNAME),x.value=e.data[0].BK_YEAR_OF_PUBLICATION,B.value=e.data[0].BK_RATE,C.value=e.data[0].BK_DESCRIPTION}catch(e){console.log(e.response)}};Ie(async()=>{console.log("onMounted"),J.value=!0,z=="new"?(X.value="Biztos menti az új könyvet?",T.value="Kötelező mező!",K.value="Kötelező mező!",A.value="Kötelező mező!",S.value="Kötelező mező!"):z=="modify"&&(X.value="Biztos menti a könyv módosítását?"),z!="new"&&await de("BK/"+I.currentRoute.value.query.id),J.value=!1}),ge(()=>I.currentRoute.value.params.type,()=>{console.log(I.currentRoute.value.params.type),location.reload()});async function se(){if(console.log("saveBook!!!"),!(T.value==""&&K.value==""&&S.value==""&&A.value==""))w.value=" Vannak kitöltetlen kötelező mezők! ",U.value="red",g.value=!0,setTimeout(()=>{g.value=!1},2e3);else{ue.value=!0,console.log(ee.value.res);const p=o("");let i=o(""),m=o(null);try{if(z=="new"){var u="INSERT INTO BOOK (BK_BOOKTITLE, BK_READED, BK_USER",e=" VALUES ('"+P.value+"', '"+d.value+"', '"+be.value+"'";s.value.AT_ID&&(u=u+", BK_AT",e=e+", "+s.value.AT_ID),c.value.CG_ID&&(u=u+", BK_CG_ID",e=e+", "+c.value.CG_ID),D.value.BT_ID&&(u=u+", BK_BT",e=e+", "+D.value.BT_ID),u=u+", BK_OS_ID",k.value!=null?e=e+", "+k.value.OS_ID:e=e+", NULL",u=u+", BK_PS_ID",b.value!=null?e=e+", "+b.value.PS_ID:e=e+", NULL",x.value!=null&&(u=u+", BK_YEAR_OF_PUBLICATION",e=e+", "+x.value),B.value!=null&&(u=u+", BK_RATE",e=e+", "+B.value),C.value!=null&&(u=u+", BK_DESCRIPTION",e=e+", '"+C.value+"'"),m=await F.post("/book",{query:u+")"+e+")"}),i.value="felvitele"}else{var t="UPDATE BOOK SET BK_BOOKTITLE = '"+P.value+"', BK_READED = '"+d.value+"'";s.value.AT_ID&&(t=t+", BK_AT = "+s.value.AT_ID),c.value.CG_ID&&(t=t+", BK_CG_ID = "+c.value.CG_ID),D.value.BT_ID&&(t=t+", BK_BT = "+c.value.BT_ID),k.value!=null?t=t+", BK_OS_ID = "+k.value.OS_ID:t=t+", BK_OS_ID = NULL",b.value!=null?t=t+", BK_PS_ID = "+b.value.PS_ID:t=t+", BK_PS_ID = NULL",x.value!=null&&(t=t+", BK_YEAR_OF_PUBLICATION = "+x.value),B.value!=null&&(t=t+", BK_RATE = "+B.value),C.value!=null&&(t=t+", BK_DESCRIPTION = '"+C.value+"'"),t=t+" WHERE BK_ID = "+I.currentRoute.value.query.id,m=await F.post("/book",{query:t}),i.value="módosítása"}console.log("res: ",m),m&&m.status=="200"?p.value="A könyv "+i.value+" sikeresen megtörtént!":p.value="Hiba történt a könyv "+i.value+" közben!"}catch(E){console.log(E.response),p.value="Hiba történt a könyv "+i.value+" közben!",w.value=p.value,U.value="red",g.value=!0,setTimeout(()=>{g.value=!1},2e3)}w.value=p.value,U.value="green",g.value=!0,setTimeout(()=>{g.value=!1},2e3),await I.replace("/")}}function pe(){d.value==="P"?d.value="Y":d.value==="Y"?d.value="N":d.value="P",G.value=G.value==="mdi-book-open-page-variant-outline"?"fa-regular fa-calendar-check":G.value==="fa-regular fa-calendar-check"?"fa fa-book":"mdi-book-open-page-variant-outline",Q.value=(Q.value+1)%q.length}async function me(u,e){await ie({action:u,myDialog:e,selectedItem:ne,cat:N.value,fetchData:Te,snackbarState:{color:U,message:w,active:g}})}return(u,e)=>{const t=_("v-col"),p=_("v-text-field"),i=_("v-icon"),m=_("v-btn"),E=_("v-tooltip"),Z=_("v-card"),$=_("v-autocomplete"),_e=_("v-rating"),ce=_("v-textarea"),ae=_("v-row"),fe=_("v-container");return y(),f(fe,{fluid:""},{default:n(()=>[g.value==!0?(y(),f(Be,{key:0,p_title:w.value,p_color:U.value},null,8,["p_title","p_color"])):h("",!0),a(ae,null,{default:n(()=>[a(t,{cols:"2"}),a(t,{cols:"8"},{default:n(()=>[a(Z,{rounded:"lg",elevation:"16",color:"black",variant:"tonal",style:{padding:"10px","background-color":"antiquewhite"},loading:J.value},{default:n(()=>[r(j)&&r(V)&&r(Y)&&r(H)&&r(W)?(y(),f(ae,{key:0},{default:n(()=>[a(t,{cols:"8"},{default:n(()=>[a(p,{modelValue:P.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>P.value=l),e[3]||(e[3]=l=>T.value="")],clearable:!v,label:"Cím",variant:"solo-filled",readonly:v,class:De({disabledback:v}),density:"compact",required:!0,rules:[l=>!!l],"error-messages":T.value,onKeyup:e[1]||(e[1]=l=>P.value==""?T.value="Kötelező mező!":T.value=""),"onClick:clear":e[2]||(e[2]=l=>T.value="Kötelező mező!")},null,8,["modelValue","clearable","readonly","class","rules","error-messages"])]),_:1}),a(t,{cols:"1",style:{padding:"18px 0px 0px 0px"}},{default:n(()=>[a(Z,{class:"text-center grey d-flex flex-column align-center justify-center",height:"50%",width:"50%"},{default:n(()=>[a(m,{color:d.value==="Y"?"green":d.value==="P"?"red":"grey",icon:"",onClick:e[4]||(e[4]=l=>pe()),class:"ma-0",rounded:"",disabled:v},{default:n(()=>[a(i,null,{default:n(()=>[R(ke(G.value),1)]),_:1})]),_:1},8,["color"]),a(E,{activator:"parent",location:"end",text:d.value==="P"?"Olvasás alatt":d.value==="Y"?"Elolvasott":"Olvasásra vár"},null,8,["text"])]),_:1})]),_:1}),a(t,{cols:"2"},{default:n(()=>[a(oe,{p_visible:O.value,"onUpdate:p_visible":e[5]||(e[5]=l=>O.value=l),ref_key:"myNewDialog",ref:le,p_defvalue:"",p_type:"brown",p_headerTitle:r(ve),p_colpadding:"padding: 0px 7px 0px 0px",p_color:"black",p_variant:"tonal",p_textFieldLabel:r(re),p_required:" true ",p_action:"add",onSave:e[6]||(e[6]=l=>me("add",le.value)),p_autocomplete:N.value=="AT",p_acDefaultValue:"",p_acLabel:"Nemzetiség",p_acItems:r(Ke),p_acKey:"NN_ID",p_acTitle:"NN_NATIONALITY",p_acValue:"NN_ID"},null,8,["p_visible","p_headerTitle","p_textFieldLabel","p_autocomplete","p_acItems"])]),_:1}),a(t,{cols:"4"},{default:n(()=>[(y(),f($,{style:{"min-width":"250px"},clearable:!v,modelValue:s.value,"onUpdate:modelValue":[e[7]||(e[7]=l=>s.value=l),e[10]||(e[10]=l=>s.value!=""||s.value!=null||s.value!=null?K.value="":null)],label:"Szerző",items:r(j),key:u.AT_ID,"item-title":"AT_AUTHORNAME","item-value":"AT_ID",variant:"solo-filled","return-object":"",readonly:v,density:"compact","no-data-text":"Nincs a keresésnek megfelelő adat",required:!0,rules:[l=>!!l],"error-messages":K.value,onKeyup:e[8]||(e[8]=l=>s.value==""||s.value==null||s.value==null?K.value="Kötelező mező!":K.value=""),"onClick:clear":e[9]||(e[9]=l=>K.value="Kötelező mező!")},null,8,["clearable","modelValue","items","readonly","rules","error-messages"]))]),_:1}),a(m,{icon:"",style:{"margin-top":"12px"},onClick:e[11]||(e[11]=l=>{r(M)("AT"),N.value="AT",O.value=!0})},{default:n(()=>[a(i,null,{default:n(()=>[R("fa fa-pencil")]),_:1}),a(E,{activator:"parent",text:"Új szerző",location:"left"})]),_:1}),a(t,{cols:"2"},{default:n(()=>[(y(),f($,{style:{"min-width":"150px"},modelValue:c.value,"onUpdate:modelValue":[e[12]||(e[12]=l=>c.value=l),e[15]||(e[15]=l=>S.value="")],clearable:!v,label:"Műfaj",items:r(V),key:u.CG_ID,"item-title":"CG_CATEGORY","item-value":"CG_ID",variant:"solo-filled","return-object":"",readonly:v,density:"compact",required:!0,rules:[l=>!!l],"error-messages":S.value,onKeyup:e[13]||(e[13]=l=>c.value==""||c.value==null?S.value="Kötelező mező!":S.value=""),"onClick:clear":e[14]||(e[14]=l=>S.value="Kötelező mező!")},null,8,["modelValue","clearable","items","readonly","rules","error-messages"]))]),_:1}),a(m,{icon:"",style:{"margin-top":"12px"},onClick:e[16]||(e[16]=l=>{r(M)("CG"),N.value="CG",O.value=!0})},{default:n(()=>[a(i,null,{default:n(()=>[R("fa fa-pencil")]),_:1}),a(E,{activator:"parent",text:"Új műfaj",location:"left"})]),_:1}),a(t,{cols:"3"},{default:n(()=>[(y(),f($,{style:{"min-width":"150px"},modelValue:D.value,"onUpdate:modelValue":[e[17]||(e[17]=l=>D.value=l),e[20]||(e[20]=l=>A.value="")],clearable:!v,label:"Kategória",items:r(Y),key:u.BT_ID,"item-title":"BT_TYPENAME","item-value":"BT_ID",variant:"solo-filled","return-object":"",readonly:v,density:"compact",required:!0,rules:[l=>!!l],"error-messages":A.value,onKeyup:e[18]||(e[18]=l=>D.value==""||D.value==null?A.value="Kötelező mező!":A.value=""),"onClick:clear":e[19]||(e[19]=l=>A.value="Kötelező mező!")},null,8,["modelValue","clearable","items","readonly","rules","error-messages"]))]),_:1}),a(m,{icon:"",style:{"margin-top":"12px"},onClick:e[21]||(e[21]=l=>{r(M)("BT"),N.value="BT",O.value=!0})},{default:n(()=>[a(i,null,{default:n(()=>[R("fa fa-pencil")]),_:1}),a(E,{activator:"parent",text:"Új kategória",location:"left"})]),_:1}),a(t,{cols:"3"},{default:n(()=>[(y(),f($,{style:{"min-width":"150px"},modelValue:k.value,"onUpdate:modelValue":e[22]||(e[22]=l=>k.value=l),clearable:!v,label:"Státusz",items:r(H),key:u.OS_ID,"item-title":"OS_NAME","item-value":"OS_ID",variant:"solo-filled","return-object":"",readonly:v,density:"compact"},null,8,["modelValue","clearable","items","readonly"]))]),_:1}),a(m,{icon:"",style:{"margin-top":"12px"},onClick:e[23]||(e[23]=l=>{r(M)("OS"),N.value="OS",O.value=!0})},{default:n(()=>[a(i,null,{default:n(()=>[R("fa fa-pencil")]),_:1}),a(E,{activator:"parent",text:"Új státusz",location:"left"})]),_:1}),a(t,{cols:"3"},{default:n(()=>[(y(),f($,{style:{"min-width":"150px"},modelValue:b.value,"onUpdate:modelValue":e[24]||(e[24]=l=>b.value=l),clearable:!v,label:"Kiadó",items:r(W),key:u.PS_ID,"item-title":"PS_PUBLISHERNAME","item-value":"PS_ID",variant:"solo-filled","return-object":"",readonly:v,density:"compact"},null,8,["modelValue","clearable","items","readonly"]))]),_:1}),a(m,{icon:"",style:{"margin-top":"12px"},onClick:e[25]||(e[25]=l=>{r(M)("PS"),N.value="PS",O.value=!0})},{default:n(()=>[a(i,null,{default:n(()=>[R("fa fa-pencil")]),_:1}),a(E,{activator:"parent",text:"Új kiadó",location:"left"})]),_:1}),a(t,{cols:"2"},{default:n(()=>[a(p,{modelValue:x.value,"onUpdate:modelValue":e[26]||(e[26]=l=>x.value=l),type:"number",label:"Kiadás dátuma",variant:"solo-filled",readonly:v,density:"compact"},null,8,["modelValue","readonly"])]),_:1}),a(t,{cols:"2"},{default:n(()=>[a(_e,{style:{"padding-left":"10px"},class:"mt-3",modelValue:B.value,"onUpdate:modelValue":e[27]||(e[27]=l=>B.value=l),"half-increments":"",hover:"",length:5,size:u.x-u.large,"model-value":B.value,color:"black","active-color":"red","empty-icon":"mdi-heart-outline","half-icon":"mdi-heart-half-full","full-icon":"mdi-heart",readonly:v},null,8,["modelValue","size","model-value","readonly"])]),_:1}),a(t,{cols:"12"},{default:n(()=>[a(ce,{modelValue:C.value,"onUpdate:modelValue":e[28]||(e[28]=l=>C.value=l),rounded:"lg",elevation:"16",label:"Leírás",variant:"solo-filled",readonly:v,density:"compact"},null,8,["modelValue","readonly"])]),_:1})]),_:1})):h("",!0),r(z)!="details"?(y(),f(Z,{key:1,rounded:"lg",elevation:"16",variant:"tonal"},{default:n(()=>[a(oe,{ref_key:"refMyDialog",ref:ee,p_type:"brown",p_btnName:"Mentés",p_disabled:!(T.value==""&&K.value==""&&S.value==""&&A.value==""),modtype:"error",p_headerTitle:"Mentés jóváhagyása",p_title:X.value,p_color:"black",onClose:e[29]||(e[29]=l=>se())},null,8,["p_disabled","p_title"])]),_:1})):h("",!0)]),_:1},8,["loading"])]),_:1}),a(t,{cols:"2"})]),_:1})]),_:1})}}};export{Pe as default};
